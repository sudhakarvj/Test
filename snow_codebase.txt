import os
import docx2txt
import logging

logger = logging.getLogger(__name__)

class SOPLoader:
    def __init__(self, sop_folder="./SOP"):
        self.sop_folder = sop_folder

    def load_sops(self):
        combined_text = ""
        try:
            if not os.path.exists(self.sop_folder):
                os.makedirs(self.sop_folder)
                return "No SOP documents found."

            for filename in os.listdir(self.sop_folder):
                if filename.endswith(".docx"):
                    file_path = os.path.join(self.sop_folder, filename)
                    text = docx2txt.process(file_path)
                    combined_text += f"\n--- SOP: {filename} ---\n{text}\n"
            
            return combined_text if combined_text else "No content found in SOPs."
        except Exception as e:
            logger.error(f"Error loading SOPs: {e}")
            return "Error loading SOP documents."
